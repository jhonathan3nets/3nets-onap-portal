# Pull base image.
#FROM ubuntu-openjdk-8-jdk

FROM ubuntu:14.04

ARG HTTP_PROXY=${HTTP_PROXY}
ARG HTTPS_PROXY=${HTTPS_PROXY}

ENV http_proxy $HTTP_PROXY
ENV https_proxy $HTTPS_PROXY

RUN if [ ! -z ${HTTP_PROXY} ]; then echo "Acquire::http::proxy  \"${HTTP_PROXY}\";" >> /etc/apt/apt.conf; fi && \
    if [ ! -z ${HTTPS_PROXY} ]; then echo "Acquire::https::proxy \"${HTTPS_PROXY}\";" >> /etc/apt/apt.conf; fi

# Install the python script required for "add-apt-repository"
RUN apt-get update && apt-get install -y software-properties-common

# Sets language to UTF8 : this works in pretty much all cases
ENV LANG en_US.UTF-8
RUN locale-gen $LANG

# Setup the openjdk 8 repo
RUN add-apt-repository ppa:openjdk-r/ppa

# Install java8
RUN apt-get update && apt-get install -y openjdk-8-jdk

# Setup JAVA_HOME, this is useful for docker commandline
ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/
RUN export JAVA_HOME

# Show java version (for debugging)
# RUN java -version

RUN apt-get update
RUN apt-get install -y curl
# Install Tomcat
RUN cd /tmp && curl -O https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.37/bin/apache-tomcat-8.0.37.tar.gz
RUN tar -xzf /tmp/apache-tomcat-8.0.37.tar.gz
RUN mv apache-tomcat-8.0.37 /opt

# Define working directory.
WORKDIR /opt/apache-tomcat-8.0.37/bin 

# Define commonly used ENV variables
ENV PATH $PATH:$JAVA_HOME/bin:/opt/apache-tomcat-8.0.37/bin

VOLUME /opt/apache-tomcat-8.0.37/logs

ARG VERSION=${VERSION:-1.1.0}
#LABEL Version=${VERSION}
ARG SDK_DIR=${SDK_DIR}
ARG FE_DIR=${FE_DIR}
ARG PORTAL_SDK_DIR=${PORTAL_SDK_DIR}
ARG PORTAL_DBC_DIR=${PORTAL_DBC_DIR}
# Set up variables:
ENV TOMCATHOME /opt/apache-tomcat-8.0.37
ENV SDKHOME /PROJECT/APPS/ECOMPPORTAL/ECOMPPORTALAPP
ENV PORTALSDKHOME /PROJECT/APPS/ECOMPPORTAL/ECOMPSDKAPP
ENV PORTALDBCHOME /PROJECT/APPS/ECOMPPORTAL/ECOMPDBCAPP
# Install Common Software,Git,Apache
RUN mkdir -p $SDKHOME &&  mkdir -p $PORTALSDKHOME &&  mkdir -p $PORTALDBCHOME

COPY ${SDK_DIR} ${SDKHOME}/ 
COPY ${PORTAL_SDK_DIR} ${PORTALSDKHOME}/
COPY ${PORTAL_DBC_DIR} ${PORTALDBCHOME}/

RUN ln -s ${SDKHOME} ${TOMCATHOME}/webapps/ECOMPPORTAL &&  ln -s ${PORTALSDKHOME} ${TOMCATHOME}/webapps/ECOMPSDKAPP &&  ln -s ${PORTALDBCHOME} ${TOMCATHOME}/webapps/ECOMPDBCAPP


# Define working directory.
WORKDIR ${TOMCATHOME}/bin 
VOLUME ${TOMCATHOME}/logs
# Define commonly used ENV variables
ENV PATH $PATH:$JAVA_HOME/bin:${TOMCATHOME}/bin
COPY configure-and-run.sh /PROJECT/OpenSource/UbuntuEP/ 

#RUN cp -r ${FE_DIR}/dist/public  ${SDKHOME}/public

COPY ${FE_DIR}/dist/public ${SDKHOME}/public 
# Define default command.
#CMD ["bash"]
CMD ["/PROJECT/OpenSource/UbuntuEP/configure-and-run.sh"]
